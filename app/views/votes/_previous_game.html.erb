<% if Current.user.host? && Current.game_session.punish_previous_game_tags? %>
    <div class="p-4 bg-slate-900 border border-slate-800 rounded-2xl flex flex-col sm:flex-row items-center justify-between gap-4 animate-in fade-in slide-in-from-top-4">
        <div class="flex items-center gap-3 w-full sm:w-auto">
            <div class="p-2 bg-purple-500/10 rounded-xl text-purple-400 shrink-0">
                <%= heroicon "no-symbol", variant: :outline, options: { class: "w-5 h-5" } %>
            </div>
            <div>
                <h3 class="text-sm font-bold text-white">Previous Game</h3>
                <p class="text-xs text-slate-400">Select to apply penalty</p>
            </div>
        </div>
        
        <div class="relative w-full sm:w-64" data-controller="dropdown">
          <%= form_with model: Current.game_session, url: settings_path, method: :patch, data: { controller: "auto-submit" } do |f| %>
            <%= hidden_field_tag :view, params[:view] %>
            <%= f.hidden_field :previous_game_id, 
                value: Current.game_session.previous_game_id,
                data: { dropdown_target: "hiddenInput", action: "change->auto-submit#submit" } %>
            
            <button type="button" 
                    data-dropdown-target="button"
                    data-action="click->dropdown#toggle"
                    class="w-full flex items-center justify-between bg-slate-950 border border-slate-700 hover:border-purple-500/50 text-white rounded-xl py-2 px-4 shadow-sm font-medium transition-all text-sm group">
                <span data-dropdown-target="selectedText" class="truncate">
                    <%= Current.game_session.previous_game&.name || "Select previous game..." %>
                </span>
                <%= heroicon "chevron-down", variant: :mini, options: { class: "w-4 h-4 text-slate-500 group-hover:text-purple-400 transition-colors ml-2 shrink-0" } %>
            </button>

            <div data-dropdown-target="menu" 
                 class="hidden absolute z-50 w-full mt-2 bg-slate-900 border border-slate-800 rounded-xl shadow-2xl overflow-hidden transform origin-top transition-all duration-100 opacity-0 scale-95 max-h-60 overflow-y-auto custom-scrollbar">
                <div class="p-1">
                    <div class="px-3 py-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest border-b border-slate-800/50 mb-1">
                        Available Games
                    </div>
                    
                    <% Game.where(game_session: Current.game_session).order(:name).each do |game| %>
                        <button type="button"
                                data-action="click->dropdown#select"
                                data-value="<%= game.id %>"
                                data-text="<%= game.name %>"
                                class="w-full text-left px-3 py-2.5 rounded-lg text-sm transition-all flex items-center gap-3 group <%= Current.game_session.previous_game_id == game.id ? 'bg-purple-600/20 text-purple-400' : 'text-slate-400 hover:bg-slate-800 hover:text-white' %>">
                            <div class="w-1.5 h-1.5 rounded-full transition-colors <%= Current.game_session.previous_game_id == game.id ? 'bg-purple-500' : 'bg-slate-700 group-hover:bg-slate-500' %>"></div>
                            <span class="truncate"><%= game.name %></span>
                        </button>
                    <% end %>

                    <% if Game.where(game_session: Current.game_session).empty? %>
                        <div class="px-3 py-4 text-center text-xs text-slate-500 italic">
                            No games found
                        </div>
                    <% end %>
                </div>
            </div>
          <% end %>
        </div>
    </div>
<% end %>
