<%= turbo_stream_from "games" %>

<div class="min-h-screen bg-slate-950 text-slate-100 font-sans selection:bg-purple-500/30 pb-20">
    <% content_for :header_actions do %>
        <%= button_to reset_votes_path, method: :post, class: "p-2 text-slate-400 hover:text-red-400 transition-colors bg-slate-800/50 rounded-lg border border-slate-700", title: "Reset All Votes", form: { data: { turbo_confirm: "Clear all votes for a new round?" } } do %>
            <%= heroicon "arrow-path", variant: :outline, options: { class: "w-4 h-4" } %>
        <% end %>
    <% end %>

    <%= render "shared/header" %>

    <main class="max-w-6xl mx-auto p-4 sm:p-6 space-y-12">
        <div class="space-y-6" data-controller="view-mode">
            <!-- View Mode Controls and Title -->
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div class="flex items-center gap-4">
                    <div>
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <%= heroicon "squares-2x2", variant: :outline, options: { class: "w-6 h-6 text-purple-500" } %>
                            Voting Room
                        </h2>
                        <p class="text-slate-400 text-sm">Cast your votes for the next game</p>
                    </div>

                    <div class="flex items-center bg-slate-900 border border-slate-800 rounded-lg p-1 h-fit self-start">
                        <button data-view-mode-target="gridBtn" data-action="click->view-mode#setGrid" class="p-1 px-2 rounded-md transition-colors text-slate-400 hover:text-white" title="Grid View">
                            <%= heroicon "squares-2x2", variant: :outline, options: { class: "w-5 h-5" } %>
                        </button>
                        <button data-view-mode-target="listBtn" data-action="click->view-mode#setList" class="p-1 px-2 rounded-md transition-colors text-slate-400 hover:text-white" title="List View">
                            <%= heroicon "bars-3", variant: :outline, options: { class: "w-5 h-5" } %>
                        </button>
                    </div>
                </div>

                <!-- Tag-based Filtering Tabs -->
                <div class="flex flex-wrap gap-2">
                    <%= link_to "ALL", votes_path(tag: 'All'), class: "px-3 py-1 rounded-full text-xs font-black tracking-widest border transition-all #{ params[:tag].blank? || params[:tag] == 'All' ? 'bg-purple-600 border-purple-400 text-white' : 'bg-slate-900 border-slate-700 text-slate-400' }" %>
                    
                    <% Tag.order(:name).each do |tag| %>
                        <%= link_to tag.name.upcase, votes_path(tag: tag.name), class: "px-3 py-1 rounded-full text-xs font-black tracking-widest border transition-all #{ params[:tag] == tag.name ? 'bg-purple-600 border-purple-400 text-white' : 'bg-slate-900 border-slate-700 text-slate-400' }" %>
                    <% end %>
                </div>
            </div>

            <!-- Games Display Container (Supports Grid and List View) -->
            <div id="games_grid" data-view-mode-target="container" class="group/view grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 transition-all duration-300 data-[view=list]:grid-cols-1 data-[view=list]:gap-2 data-[view=list]:max-w-2xl data-[view=list]:mx-auto">
                <%= render partial: "votes/card", collection: @games, as: :game %>
                
                <% if @games.empty? %>
                    <div class="col-span-full py-20 text-center text-slate-500 border-2 border-dashed border-slate-800 rounded-3xl italic">
                        No games found.
                    </div>
                <% end %>
            </div>
        </div>
    </main>
</div>
