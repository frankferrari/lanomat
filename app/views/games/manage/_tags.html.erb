<% picker_id = game.persisted? ? "tag-picker-#{game.id}" : "tag-picker-new-game" %>

<!-- Hidden checkbox to control overlay visibility -->
<input type="checkbox" id="<%= picker_id %>" class="peer/overlay hidden">

<!-- Overlay backdrop - shown when checkbox is checked -->
<label for="<%= picker_id %>" class="peer-checked/overlay:flex hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 items-center justify-center cursor-pointer">
  <!-- Modal content - prevent closing when clicking inside -->
  <div class="bg-slate-900 rounded-2xl border border-slate-800 shadow-2xl w-full max-w-2xl mx-4 p-6 cursor-default" onclick="event.stopPropagation()">
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-bold text-white">Select Tags</h3>
      <label for="<%= picker_id %>" class="p-2 text-slate-400 hover:text-white transition-colors cursor-pointer">
        <%= heroicon "x-mark", variant: :outline, options: { class: "w-6 h-6" } %>
      </label>
    </div>

    <!-- Tag Selection Form -->
    <%= form_with(model: game, class: "space-y-6") do |f| %>
      <!-- Available Tags -->
      <div>
        <p class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-3">Available Tags</p>
        <div class="flex flex-wrap gap-2 max-h-64 overflow-y-auto p-4 bg-slate-950 rounded-xl border border-slate-800">
          <% Tag.order(:name).each do |tag| %>
            <% checkbox_id = "tag_#{game.object_id}_#{tag.id}" %>
            <%= f.check_box :tag_ids, 
                { multiple: true, checked: game.tag_ids.include?(tag.id), class: "peer/tag hidden", id: checkbox_id }, 
                tag.id, 
                nil %>
            <label for="<%= checkbox_id %>" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border cursor-pointer transition-all
                   bg-slate-800/30 border-slate-700/50 text-slate-400 hover:border-purple-500/50 hover:text-purple-300
                   peer-checked/tag:bg-purple-600/20 peer-checked/tag:border-purple-500/50 peer-checked/tag:text-purple-300
                   text-xs font-bold uppercase tracking-wider">
              <%= heroicon "tag", variant: :solid, options: { class: "w-3 h-3" } %>
              <span><%= tag.name %></span>
            </label>
          <% end %>
          
          <% if Tag.none? %>
            <p class="w-full text-slate-500 text-sm text-center py-4">No tags yet. Create one below!</p>
          <% end %>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="flex gap-3 justify-end">
        <label for="<%= picker_id %>" class="px-6 py-2.5 rounded-xl font-bold text-slate-400 hover:text-white transition-colors cursor-pointer">
          Cancel
        </label>
        <%= f.submit "Apply", class: "bg-purple-600 hover:bg-purple-500 px-6 py-2.5 rounded-xl font-bold text-white transition-colors cursor-pointer" %>
      </div>
    <% end %>
  </div>
</label>
