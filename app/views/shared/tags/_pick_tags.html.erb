<% picker_id = game.persisted? ? "tag-picker-#{game.id}" : "tag-picker-new-game" %>

<!-- Hidden checkbox to control overlay visibility -->
<input type="checkbox" id="<%= picker_id %>" class="peer/overlay hidden">

<!-- Overlay backdrop - shown when checkbox is checked -->
<label for="<%= picker_id %>" class="peer-checked/overlay:flex hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 items-center justify-center cursor-pointer">
<!-- Modal content - prevent closing when clicking inside -->
  <div class="bg-slate-900 rounded-2xl border border-slate-800 shadow-2xl w-full max-w-2xl mx-4 p-6 cursor-default" onclick="event.stopPropagation()">
    <!-- Modal Header: Label and Close Control -->
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-bold text-white">Select Tags</h3>
      <label for="<%= picker_id %>" class="p-2 text-slate-400 hover:text-white transition-colors cursor-pointer">
        <%= heroicon "x-mark", variant: :outline, options: { class: "w-6 h-6" } %>
      </label>
    </div>

    <!-- Selection Content: Dynamic based on persistence state -->
    <% if local_assigns[:f] %>
        <!-- Nested Mode (New Game) -->
        <div class="space-y-6">
            <%= render "shared/tags/display_tags", f: f, game: game %>
            
            <div class="flex gap-3 justify-end">
                <label for="<%= picker_id %>" class="px-6 py-2.5 rounded-xl font-bold text-slate-400 hover:text-white transition-colors cursor-pointer">
                  Done
                </label>
            </div>
        </div>
    <% else %>
        <!-- Standalone Mode (Existing Game) -->
        <%= form_with(model: game, class: "space-y-6") do |f| %>
            <%= render "shared/tags/display_tags", f: f, game: game %>

            <div class="flex gap-3 justify-end">
                <label for="<%= picker_id %>" class="px-6 py-2.5 rounded-xl font-bold text-slate-400 hover:text-white transition-colors cursor-pointer">
                  Cancel
                </label>
                <%= f.submit "Apply", class: "bg-purple-600 hover:bg-purple-500 px-6 py-2.5 rounded-xl font-bold text-white transition-colors cursor-pointer" %>
            </div>
        <% end %>
    <% end %>
  </div>
</label>
