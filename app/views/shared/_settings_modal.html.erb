<dialog data-modal-overlay-target="modal" class="m-auto fixed inset-0 backdrop:bg-slate-950/80 backdrop:backdrop-blur-md bg-transparent p-0 overflow-visible max-w-2xl w-[calc(100%-2rem)] outline-none open:animate-in open:fade-in open:zoom-in open:duration-200">
  <div class="bg-slate-900 border border-slate-800 rounded-3xl shadow-2xl overflow-hidden">
    <div class="p-8">
      <div class="flex items-center justify-between mb-8">
        <div>
          <h2 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">Voting Settings</h2>
          <p class="text-slate-400 mt-1">Configure session rules and behavior.</p>
        </div>
        <button type="button" data-action="modal-overlay#close" class="p-2 text-slate-400 hover:text-white transition-colors cursor-pointer rounded-xl hover:bg-slate-800">
          <%= heroicon "x-mark", variant: :outline, options: { class: "w-6 h-6" } %>
        </button>
      </div>

      <%= form_with model: Current.game_session, url: settings_path, method: :patch, class: "space-y-8" do |f| %>
        <div class="space-y-6 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
          <!-- Voting Rules Section -->
          <section class="space-y-4">
            <h3 class="text-sm font-black text-slate-500 uppercase tracking-widest flex items-center gap-2">
              <%= heroicon "trophy", variant: :outline, options: { class: "w-4 h-4" } %>
              Voting Rules
            </h3>

            <div class="grid gap-4">
              <!-- Bonus Votes Pool -->
              <div class="p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50" data-controller="toggle">
                <div class="flex items-center justify-between">
                  <div>
                    <label class="block text-sm font-semibold text-white">Bonus Votes Pool</label>
                    <p class="text-xs text-slate-400">Enable global bonus votes</p>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <%= f.check_box :enable_bonus_votes, class: "sr-only peer", data: { toggle_target: "input", action: "change->toggle#toggle" } %>
                    <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                  </label>
                </div>

                <div class="hidden mt-4 pt-4 border-t border-slate-700/50" data-toggle-target="content">
                  <div class="flex items-center justify-between">
                    <span class="text-xs font-medium text-slate-400">Total Bonus Votes</span>
                    <%= f.number_field :bonus_votes, class: "w-20 bg-slate-950 border-slate-700 text-white rounded-xl focus:ring-purple-500 focus:border-purple-500 text-center font-bold", data: { toggle_default: 0 } %>
                  </div>
                </div>
              </div>

              <!-- Punish Previous Game -->
              <div class="p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50" data-controller="toggle">
                <div class="flex items-center justify-between">
                  <div>
                    <label class="block text-sm font-semibold text-white">Punish Previous Game Tags</label>
                    <p class="text-xs text-slate-400">Punishes games based on previous game by their assigned tags</p>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <%= f.check_box :punish_previous_game_tags, class: "sr-only peer", data: { toggle_target: "input", action: "change->toggle#toggle" } %>
                    <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                  </label>
                </div>

                <div class="hidden mt-4 space-y-4 pt-4 border-t border-slate-700/50" data-toggle-target="content">
                  
                  <div class="flex items-center justify-between">
                    <div>
                      <label class="block text-xs font-semibold text-white">Penalty Votes</label>
                      <p class="text-[10px] text-slate-500 italic">Votes to subtract from similar games</p>
                    </div>
                    <%= f.number_field :previous_game_penalty, class: "w-20 bg-slate-950 border-slate-700 text-white rounded-xl focus:ring-purple-500 focus:border-purple-500 text-center font-bold", data: { toggle_default: 0 } %>
                  </div>

                  <div class="pt-4 border-t border-slate-700/30 flex items-center justify-between">
                    <div>
                      <label class="block text-xs font-semibold text-white">Block Previous Winner</label>
                      <p class="text-[10px] text-slate-500 italic">Completely remove previous game from voting</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <%= f.check_box :exclude_previous_game, class: "sr-only peer" %>
                      <div class="w-9 h-5 bg-slate-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-pink-600"></div>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Voting Countdown -->
              <div class="p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50" data-controller="toggle">
                <div class="flex items-center justify-between">
                  <div>
                    <label class="block text-sm font-semibold text-white">Time-Limited Voting</label>
                    <p class="text-xs text-slate-400">Enable countdown timer</p>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <%= f.check_box :voting_countdown_enabled, class: "sr-only peer", data: { toggle_target: "input", action: "change->toggle#toggle" } %>
                    <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                  </label>
                </div>
                
                <div class="hidden mt-4 pt-4 border-t border-slate-700/50" data-toggle-target="content">
                  <div class="flex items-center justify-between">
                    <span class="text-xs font-medium text-slate-400">Duration</span>
                    <div class="flex items-center gap-2">
                      <%= f.number_field :voting_countdown_duration_minutes, class: "w-20 bg-slate-950 border-slate-700 text-white rounded-xl focus:ring-purple-500 focus:border-purple-500 text-center font-bold", data: { toggle_default: 5 } %>
                      <span class="text-xs text-slate-500 font-bold uppercase">min</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Wheel of Fortune Section -->
          <section class="space-y-4">
            <h3 class="text-sm font-black text-slate-500 uppercase tracking-widest flex items-center gap-2">
              <%= heroicon "arrow-path", variant: :outline, options: { class: "w-4 h-4" } %>
              Wheel of Fortune
            </h3>
            
            <div class="p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50 opacity-50">
              <div class="flex items-center justify-between">
                <div>
                  <label class="block text-sm font-semibold text-white">Enable Final Spin</label>
                  <p class="text-xs text-slate-400">Tie-breaker wheel at the end</p>
                </div>
                <div class="relative inline-flex items-center cursor-not-allowed">
                  <input type="checkbox" disabled class="sr-only peer">
                  <div class="w-11 h-6 bg-slate-700 rounded-full peer-checked:bg-pink-600"></div>
                </div>
              </div>

              <div class="hidden mt-4 space-y-4 border-t border-slate-700/50 pt-4">
                 <div class="flex items-center justify-between">
                    <div>
                      <label class="block text-xs font-semibold text-white">Include Top Games Only</label>
                      <p class="text-[10px] text-slate-500 italic">Filter to top 3 vated games</p>
                    </div>
                    <div class="relative inline-flex items-center cursor-not-allowed">
                     <input type="checkbox" disabled class="sr-only peer">
                     <div class="w-9 h-5 bg-slate-700 rounded-full peer-checked:bg-pink-600"></div>
                    </div>
                 </div>

                 <div class="flex items-center justify-between">
                    <div>
                      <label class="block text-xs font-semibold text-white">Weighted Slices</label>
                      <p class="text-[10px] text-slate-500 italic">Size based on vote count</p>
                    </div>
                    <div class="relative inline-flex items-center cursor-not-allowed">
                     <input type="checkbox" disabled class="sr-only peer">
                     <div class="w-9 h-5 bg-slate-700 rounded-full peer-checked:bg-pink-600"></div>
                    </div>
                 </div>
              </div>
            </div>
          </section>
        </div>

        <div class="flex items-center gap-4 pt-4 border-t border-slate-800">
          <button type="button" data-action="modal-overlay#close" class="flex-1 px-6 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold rounded-2xl transition-all text-center cursor-pointer">
            Cancel
          </button>
          <%= f.submit "Save Configuration", class: "flex-[2] px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-2xl shadow-lg shadow-purple-500/20 transition-all transform hover:scale-[1.02] active:scale-[0.98]" %>
        </div>
      <% end %>
    </div>
  </div>
</dialog>
