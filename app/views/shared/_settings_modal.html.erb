<dialog data-modal-overlay-target="modal" class="m-auto fixed inset-0 backdrop:bg-slate-950/80 backdrop:backdrop-blur-md bg-transparent p-0 overflow-visible max-w-2xl w-[calc(100%-2rem)] outline-none open:animate-in open:fade-in open:zoom-in open:duration-200">
  <div class="bg-slate-900 border border-slate-800 rounded-3xl shadow-2xl overflow-hidden">
    <div class="p-8">
      <div class="flex items-center justify-between mb-8">
        <div>
          <h2 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">Voting Settings</h2>
          <p class="text-slate-400 mt-1">Configure session rules and behavior.</p>
        </div>
        <button type="button" data-action="modal-overlay#close" class="p-2 text-slate-400 hover:text-white transition-colors cursor-pointer rounded-xl hover:bg-slate-800">
          <%= heroicon "x-mark", variant: :outline, options: { class: "w-6 h-6" } %>
        </button>
      </div>

      <%= form_with model: Current.game_session, url: settings_path, method: :patch, class: "space-y-8", data: { controller: "auto-submit", auto_submit_delay_value: 500 } do |f| %>
        <div class="space-y-6 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
          <!-- Voting Rules Section -->
          <section class="space-y-4">
            <h3 class="text-sm font-black text-slate-500 uppercase tracking-widest flex items-center gap-2">
              <%= heroicon "trophy", variant: :outline, options: { class: "w-4 h-4" } %>
              Voting Rules
            </h3>

            <div class="grid gap-4">
              <!-- Bonus Votes Pool -->
              <div class="p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50" data-controller="toggle">
                <div class="flex items-center justify-between">
                  <div>
                    <label class="block text-sm font-semibold text-white">Bonus Votes Pool</label>
                    <p class="text-xs text-slate-400">Enable global bonus votes</p>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <%= f.check_box :enable_bonus_votes, class: "sr-only peer", data: { toggle_target: "input", action: "change->toggle#toggle change->auto-submit#submit" } %>
                    <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                  </label>
                </div>

                <div class="hidden mt-4 pt-4 border-t border-slate-700/50" data-toggle-target="content">
                  <div class="flex items-center justify-between">
                    <span class="text-xs font-medium text-slate-400">Total Bonus Votes</span>
                    <%= f.number_field :bonus_votes, class: "w-20 bg-slate-950 border-slate-700 text-white rounded-xl focus:ring-purple-500 focus:border-purple-500 text-center font-bold", data: { toggle_default: 0, action: "change->auto-submit#submit" } %>
                  </div>
                </div>
              </div>

              <!-- Punish Previous Game -->
              <div class="p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50" data-controller="toggle">
                <div class="flex items-center justify-between">
                  <div>
                    <label class="block text-sm font-semibold text-white">Punish Previous Game Tags</label>
                    <p class="text-xs text-slate-400">Punishes games based on previous game by their assigned tags</p>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <%= f.check_box :punish_previous_game_tags, class: "sr-only peer", data: { toggle_target: "input", action: "change->toggle#toggle change->auto-submit#submit" } %>
                    <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                  </label>
                </div>

                <div class="hidden mt-4 space-y-4 pt-4 border-t border-slate-700/50" data-toggle-target="content">
                  
                  <div class="flex items-center justify-between">
                    <div>
                      <label class="block text-xs font-semibold text-white">Penalty Votes</label>
                      <p class="text-[10px] text-slate-500 italic">Votes to subtract from similar games</p>
                    </div>
                    <%= f.number_field :previous_game_penalty, class: "w-20 bg-slate-950 border-slate-700 text-white rounded-xl focus:ring-purple-500 focus:border-purple-500 text-center font-bold", data: { toggle_default: 0, action: "change->auto-submit#submit" } %>
                  </div>

                  <div class="pt-4 border-t border-slate-700/30 flex items-center justify-between">
                    <div>
                      <label class="block text-xs font-semibold text-white">Block Previous Winner</label>
                      <p class="text-[10px] text-slate-500 italic">Completely remove previous game from voting</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <%= f.check_box :exclude_previous_game, class: "sr-only peer", data: { action: "change->auto-submit#submit" } %>
                      <div class="w-9 h-5 bg-slate-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-pink-600"></div>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Voting Countdown -->
              <div class="p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50" data-controller="toggle">
                <div class="flex items-center justify-between">
                  <div>
                    <label class="block text-sm font-semibold text-white">Time-Limited Voting</label>
                    <p class="text-xs text-slate-400">Enable countdown timer</p>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <%= f.check_box :voting_countdown_enabled, class: "sr-only peer", data: { toggle_target: "input", action: "change->toggle#toggle change->auto-submit#submit" } %>
                    <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                  </label>
                </div>
                
                <div class="hidden mt-4 pt-4 border-t border-slate-700/50" data-toggle-target="content">
                  <div class="flex items-center justify-between">
                    <span class="text-xs font-medium text-slate-400">Duration</span>
                    <div class="flex items-center gap-2">
                      <%= f.number_field :voting_countdown_duration_minutes, class: "w-20 bg-slate-950 border-slate-700 text-white rounded-xl focus:ring-purple-500 focus:border-purple-500 text-center font-bold", data: { toggle_default: 5, action: "change->auto-submit#submit" } %>
                      <span class="text-xs text-slate-500 font-bold uppercase">min</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Wheel of Fortune Section -->
          <section class="space-y-4">
            <h3 class="text-sm font-black text-slate-500 uppercase tracking-widest flex items-center gap-2">
              <%= heroicon "arrow-path", variant: :outline, options: { class: "w-4 h-4" } %>
              Wheel of Fortune
            </h3>
            
            <div class="p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50" data-controller="toggle">
              <div class="flex items-center justify-between">
                <div>
                  <label class="block text-sm font-semibold text-white">Enable Wheel</label>
                  <p class="text-xs text-slate-400">Show "Spin the Wheel" button</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <%= f.check_box :wheel_enabled, class: "sr-only peer", data: { toggle_target: "input", action: "change->toggle#toggle change->auto-submit#submit" } %>
                  <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                </label>
              </div>

              <div class="hidden mt-4 space-y-4 border-t border-slate-700/50 pt-4" data-toggle-target="content">
                 <!-- Filter Mode -->
                 <div class="space-y-2">
                   <label class="block text-xs font-semibold text-white">Games Included</label>
                   <%= f.select :wheel_filter_mode, 
                       [["Top X Games", "top_x"], ["All Games", "all"], ["All Winners (ties only)", "winners"]], 
                       {}, 
                       class: "w-full bg-slate-950 border-slate-700 text-white rounded-xl focus:ring-purple-500 focus:border-purple-500 text-sm py-2",
                       data: { action: "change->auto-submit#submit" } %>
                 </div>

                 <!-- Top Count (shown when top_x is selected) -->
                 <div class="flex items-center justify-between">
                   <div>
                     <label class="block text-xs font-semibold text-white">Top Games Count</label>
                     <p class="text-[10px] text-slate-500 italic">Number of top voted games</p>
                   </div>
                   <%= f.number_field :wheel_filter_top_count, min: 2, max: 20, class: "w-20 bg-slate-950 border-slate-700 text-white rounded-xl focus:ring-purple-500 focus:border-purple-500 text-center font-bold", data: { action: "change->auto-submit#submit" } %>
                 </div>

                 <!-- Proportional Slices -->
                 <div class="pt-4 border-t border-slate-700/30 flex items-center justify-between">
                   <div>
                     <label class="block text-xs font-semibold text-white">Weighted Slices</label>
                     <p class="text-[10px] text-slate-500 italic">Size based on vote count</p>
                   </div>
                   <label class="relative inline-flex items-center cursor-pointer">
                     <%= f.check_box :wheel_proportional, class: "sr-only peer", data: { action: "change->auto-submit#submit" } %>
                     <div class="w-9 h-5 bg-slate-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-pink-600"></div>
                   </label>
                 </div>
              </div>
            </div>
          </section>
        </div>
      <% end %>
    </div>
  </div>
</dialog>
